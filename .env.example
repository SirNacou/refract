# Database Configuration
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=refract
POSTGRES_PASSWORD=password
POSTGRES_DB=url_shortener
DATABASE_URL=postgres://refract:password@postgres:5432/url_shortener?sslmode=disable

# Database migrations
RUN_MIGRATIONS=true

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_STREAM_KEY=refract:click_events  # Stream key for click events (shared by redirector publisher + analytics consumer)

# =============================================================================
# OIDC Configuration (Recommended - works with any OIDC provider)
# =============================================================================
# Use these settings to configure authentication with any OIDC-compliant provider
# (Zitadel, Keycloak, Auth0, Okta, etc.)
# Uses coreos/go-oidc for automatic discovery and JWKS caching.

OIDC_ISSUER=https://your-oidc-provider.com      # OIDC provider URL (e.g., https://auth.example.com)
OIDC_AUDIENCE=refract-api                        # Expected 'aud' claim in JWTs

# =============================================================================
# Zitadel Configuration (Deprecated - use OIDC_* instead)
# =============================================================================
# These settings are kept for backward compatibility. If OIDC_* vars are not set,
# ZITADEL_ISSUER and ZITADEL_CLIENT_ID will be used as fallbacks.

ZITADEL_URL=https://zitadel.nacou.uk            # URL of your existing Zitadel deployment
ZITADEL_CLIENT_ID=your_client_id_here           # From your Zitadel application configuration
ZITADEL_CLIENT_SECRET=your_client_secret_here   # From your Zitadel application configuration
ZITADEL_ISSUER=https://zitadel.nacou.uk         # Must match the issuer in JWT tokens

# API Service Configuration
API_PORT=8080
API_BASE_URL=http://localhost:8080
JWT_ISSUER=https://zitadel.nacou.uk  # Must match ZITADEL_ISSUER
WORKER_ID=1  # Snowflake ID worker ID (0-63)

# Redirector Service Configuration
REDIRECTOR_PORT=3000
REDIRECTOR_BASE_URL=http://localhost:3000
REDIRECTOR_WORKER_ID=64  # Separate range from API service
REDIRECTOR_L1_CACHE_CAPACITY=1000  # In-memory LRU cache entries
REDIRECTOR_DATABASE_URL=postgres://refract:password@postgres:5432/url_shortener?sslmode=disable
REDIRECTOR_DATABASE_MAX_CONNECTIONS=25
REDIRECTOR_DATABASE_MIN_CONNECTIONS=5
REDIRECTOR_CONNECTION_MAX_IDLE_TIME=5
REDIRECTOR_CONNECTION_MAX_LIFETIME=5
# Redirector Events Config (Redis Streams)
EVENTS_BATCH_SIZE=100  # Batch size before flushing to Redis Stream
EVENTS_FLUSH_INTERVAL_MS=1000  # Flush interval in milliseconds
EVENTS_MAX_STREAM_LEN=1000000  # Maximum stream length (oldest entries trimmed)
EVENTS_MAX_BUFFER_SIZE=10000  # Max in-memory buffer before dropping oldest

# Frontend Configuration
VITE_API_URL=http://localhost:8080
VITE_SHORT_URL_BASE=http://localhost:3000
VITE_ZITADEL_AUTHORITY=https://zitadel.nacou.uk  # Must match ZITADEL_ISSUER
VITE_ZITADEL_CLIENT_ID=your_client_id_here

# Analytics Processor Configuration
ANALYTICS_PROCESSOR_PORT=8082  # Health check endpoint port
ANALYTICS_DATABASE_URL=postgres://refract:password@postgres:5432/url_shortener?sslmode=disable
ANALYTICS_DATABASE_MAX_CONNECTIONS=10
ANALYTICS_DATABASE_MIN_CONNECTIONS=2
# Analytics Stream Consumer Config
ANALYTICS_CONSUMER_GROUP=analytics-processor  # Redis Stream consumer group name
ANALYTICS_CONSUMER_NAME=processor-1  # Consumer name (use hostname/pod ID in production)
ANALYTICS_BATCH_SIZE=100  # Number of events to read per XREADGROUP call
ANALYTICS_BLOCK_MS=1000  # Block time in milliseconds for XREADGROUP
ANALYTICS_STREAM_START=$  # Start reading from new messages ($) or beginning (0)
ANALYTICS_RETRY_MIN_BACKOFF_MS=250  # Initial backoff for Redis connection retries
ANALYTICS_RETRY_MAX_BACKOFF_MS=5000  # Maximum backoff for Redis connection retries

# MaxMind GeoIP Configuration
GEOIP_DB_PATH=./data/geoip/GeoLite2-City.mmdb
GEOIP_LICENSE_KEY=

# UA Configuration
UA_REGEXES_PATH=./data/user_agent/regexes.yaml

# Safe Browsing API Configuration (Google)
SAFE_BROWSING_API_KEY=your_google_api_key_here

# Logging
LOG_LEVEL=debug
LOG_FORMAT=json