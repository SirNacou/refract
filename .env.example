# Database Configuration
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=refract
POSTGRES_PASSWORD=password
POSTGRES_DB=url_shortener
DATABASE_URL=postgres://refract:password@postgres:5432/url_shortener?sslmode=disable

# Database migrations
RUN_MIGRATIONS=true

# Redis Configuration
REDIS_HOST=valkey
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_STREAM_KEY=refract:click_events  # Stream key for click events (shared by redirector publisher + analytics consumer)

# API Service Configuration
API_PORT=8080
API_BASE_URL=http://localhost:8080
WORKER_ID=1  # Snowflake ID worker ID (0-63)

# Redirector Service Configuration
REDIRECTOR_PORT=3000
REDIRECTOR_BASE_URL=http://localhost:3000
REDIRECTOR_WORKER_ID=64  # Separate range from API service
REDIRECTOR_L1_CACHE_CAPACITY=1000  # In-memory LRU cache entries
REDIRECTOR_DATABASE_URL=postgres://refract:password@postgres:5432/url_shortener?sslmode=disable
REDIRECTOR_DATABASE_MAX_CONNECTIONS=25
REDIRECTOR_DATABASE_MIN_CONNECTIONS=5
REDIRECTOR_CONNECTION_MAX_IDLE_TIME=5
REDIRECTOR_CONNECTION_MAX_LIFETIME=5
# Redirector Events Config (Redis Streams)
EVENTS_BATCH_SIZE=100  # Batch size before flushing to Redis Stream
EVENTS_FLUSH_INTERVAL_MS=1000  # Flush interval in milliseconds
EVENTS_MAX_STREAM_LEN=1000000  # Maximum stream length (oldest entries trimmed)
EVENTS_MAX_BUFFER_SIZE=10000  # Max in-memory buffer before dropping oldest

# Frontend Configuration
BETTER_AUTH_SECRET=G3Udav1fsTJJThhGcwCDKRvNfffrDIHv
BETTER_AUTH_URL=http://localhost:4000

VITE_PORT=4000
VITE_API_URL=http://localhost:8080
VITE_SHORT_URL_BASE=http://localhost:4000

# Frontend Zitadel Configuration (client-safe)
VITE_ZITADEL_ISSUER=https://zitadel.nacou.uk
VITE_ZITADEL_CLIENT_ID=355482909458628627
VITE_ZITADEL_REDIRECT_URI=http://localhost:4000/auth/callback
VITE_ZITADEL_POST_LOGOUT_URL=http://localhost:4000/
VITE_ZITADEL_SCOPES=openid profile email offline_access
VITE_POST_LOGIN_URL=/profile
# Appwrite Configuration
VITE_APPWRITE_ENDPOINT=https://appwrite.nacou.uk/v1
VITE_APPWRITE_PROJECT=refract


# =============================================================================
# Zitadel Configuration
# =============================================================================
# Backend authentication using Zitadel as the identity provider.
# Uses coreos/go-oidc for automatic discovery and JWKS caching.

# Frontend Zitadel Configuration (server-side)
# These MUST NOT use the VITE_ prefix because they include secrets.
ZITADEL_ISSUER=https://zitadel.nacou.uk
ZITADEL_AUTHORITY=zitadel.nacou.uk             # Zitadel issuer URL (used for JWT validation)
ZITADEL_CLIENT_ID=355622570571137043               # From your Zitadel application configuration
ZITADEL_CLIENT_SECRET=0U8FjKSv7IjydsoB7oVE50oKfKTlCVvX8NOqAlrTuscL6DxxbqE7vGlWOhMTfG2f       # From your Zitadel application configuration (if needed)
ZITADEL_AUDIENCE=refract-api                         # Expected 'aud' claim in JWTs
ZITADEL_REDIRECT_URI=http://localhost:4000/auth/callback
ZITADEL_SCOPES=openid profile email offline_access

# Analytics Processor Configuration
ANALYTICS_PROCESSOR_PORT=8082  # Health check endpoint port
ANALYTICS_DATABASE_URL=postgres://refract:password@postgres:5432/url_shortener?sslmode=disable
ANALYTICS_DATABASE_MAX_CONNECTIONS=10
ANALYTICS_DATABASE_MIN_CONNECTIONS=2
# Analytics Stream Consumer Config
ANALYTICS_CONSUMER_GROUP=analytics-processor  # Redis Stream consumer group name
ANALYTICS_CONSUMER_NAME=processor-1  # Consumer name (use hostname/pod ID in production)
ANALYTICS_BATCH_SIZE=100  # Number of events to read per XREADGROUP call
ANALYTICS_BLOCK_MS=1000  # Block time in milliseconds for XREADGROUP
ANALYTICS_STREAM_START=$  # Start reading from new messages ($) or beginning (0)
ANALYTICS_RETRY_MIN_BACKOFF_MS=250  # Initial backoff for Redis connection retries
ANALYTICS_RETRY_MAX_BACKOFF_MS=5000  # Maximum backoff for Redis connection retries

# MaxMind GeoIP Configuration
GEOIP_DB_PATH=/app/data/geoip/GeoLite2-City.mmdb
GEOIP_LICENSE_KEY=

# UA Configuration
UA_REGEXES_PATH=/app/data/user_agent/regexes.yaml

# Safe Browsing API Configuration (Google)
SAFE_BROWSING_API_KEY=AIzaSyAlf3uLtcmbPC50jhKnwgJCXp-R2MAuBYA

# Logging
LOG_LEVEL=debug
LOG_FORMAT=json

# Appwrite Configuration
APPWRITE_ENDPOINT=https://appwrite.nacou.uk/v1
APPWRITE_PROJECT=refract